PROBLEM_WITH_EXPERIENCE_TEMPLATE = """你是一个显示技术领域的专家。

# 技术提问
{problem}

# 经验与指导
在回答之前，请先仔细阅读并理解以下经验与指导（如有）：
{experiences}
"""


# New: Grading template used to judge whether extracted statements are supported by the given information
SINGLE_ROLLOUT_GRADING_TEMPLATE = """你是一位显示技术领域的专家。你的任务是根据下列”技术提问”和“初始回答”，对一系列“要点”的成立情况进行评估。

# 技术提问
{problem}

# 初始回答
{response}

你需要根据“初始回答”中的信息，对下面每一个“要点”进行评估。
# 要点
{requirements}

# 评估标准:
请为每个要点选择最符合的一个等级，并提供判断依据。你必须仅依赖”技术提问”和“初始回答”中的信息，不能引入任何外部知识。

---

### **4：直接支持**
要点的含义可以由“初始回答”中的信息直接或通过简短、明确的逻辑推断得出。

### **3：间接或部分支持**
要点可能是正确的，但“初始回答”的解释不够充分或存在关键信息缺失。例如，回答提及了相关事实，但没有解释清楚它们之间的因果关系（即“为什么”）。

### **2：逻辑或事实存在矛盾**
“初始回答”中的信息与要点存在明显矛盾，或者其内在逻辑是混乱、错误的。要点的结论无法从其前提中合理推断出来。

### **1：完全不支持**
“初始回答”中完全没有提及支持该要点所需的信息。

> **示例**:
> *   **技术提问 (假设)**: “ITO为什么在刻蚀后在退火而不在刻蚀前退火。”
> *   **初始回答 (假设)**: “如果在刻蚀前退火，会影响后续的工艺窗口，因此行业标准流程选择在刻蚀后退火，主要是为了工艺顺序的便利性。”
> *   **要点 (假设)**: “退火导致ITO结晶，结晶的ITO刻蚀难度高，刻蚀速率低。”
> *   **判定**: `grade: 3`
> *   **理由**: “间接或部分支持。初始回答提到了‘影响工艺窗口’和‘便利性’，但没有解释根本的物理原因，即‘为什么’会影响工艺窗口。它缺失了‘结晶导致刻蚀困难’这一核心因果链。”


---

# 输出格式：
在思考结束后，以“要点序号”作为键输出一个 **JSON 对象**。每个键对应一个 JSON 对象，包含 `grade` (评估等级) 和 `reason` (解释)。请确保输出为单一、格式正确的 JSON 块。

# 示例输出：
```json
{{
    "0": {{
        "grade": 2,
        "reason": "逻辑或事实存在矛盾。因为..."
    }},
    "1": {{
        "grade": 4,
        "reason": "直接支持。因为..."
    }},
    ...
}}
```
注意：你的输出必须涵盖所有要点。
"""


SINGLE_QUERY_CRITIQUE_TEMPLATE = """你是一个显示技术领域的专家。下面给出针对某一技术问题多次回答的要点判定结果（来自评分器的 JSON 输出，逐条包含“是/否+理由”）以及当前的经验库。请基于这些信息产出可复用的“经验”更新建议。

# 技术提问
{problem}

# 多次回答的要点判定结果
{grading}

# 正确答案
{answer}

# 当前经验库
{experiences}

# 要求：
1) 从判定结果中提炼规律：
   - 判定为“是”的要点：指出有效的关键决策、判断或检查点
   - 判定为“否”的要点：总结失误的原因（如假设不当、忽略边界条件、流程缺环、指标口径错误等）
2) 更新经验库（仅使用两种操作）：
   - modify：在保留原编号的前提下，改写已有经验，使其更通用/更准确
   - add：新增一条通用经验
3) 每条经验应满足：
   - 面向策略/判断/工程检查项；不要写具体结论数值或与本题强绑定的细节
   - 如需条件限制，请以内嵌方式表述："当[条件]，应[策略]"
   - 语言简洁、一条只表达一个可执行要点

# 输出格式：在思考结束后，以 JSON 数组形式输出更新操作：
```json
[
    {{
        "option": "modify",
        "experience": "修改后的经验",
        "modified_from": "3"
    }},
    {{
        "option": "add",
        "experience": "新增的经验"
    }}
]
```
注意：可以只使用一种类型的更新。
"""